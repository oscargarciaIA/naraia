version: '3.8'

services:
  # Base de Datos Corporativa (Backend)
  nara-db:
    image: pgvector/pgvector:pg16
    container_name: nara_enterprise_db
    restart: always
    environment:
      POSTGRES_USER: nara_admin
      POSTGRES_PASSWORD: secure_password_change_me
      POSTGRES_DB: nara_knowledge_hub
    volumes:
      - nara_pg_data:/var/lib/postgresql/data
      - ./db/init:/docker-entrypoint-initdb.d
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U nara_admin -d nara_knowledge_hub"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Aplicación Web (Frontend)
  nara-web:
    build: .
    container_name: nara_frontend
    restart: always
    ports:
      - "3000:3000"
    volumes:
      # Sincronización en tiempo real para desarrollo (Hot Reload)
      - .:/app
      - /app/node_modules
    environment:
      - CHOKIDAR_USEPOLLING=true
      # IMPORTANTE: Reemplaza esto con tu API Key real o usa un archivo .env
      - API_KEY=${API_KEY} 
    depends_on:
      - nara-db

volumes:
  nara_pg_data:
